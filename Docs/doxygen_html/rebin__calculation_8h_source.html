<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.9.1"/>
<title>My Project: E:/_PhD/00_PST_CURRENT/rebin_calculation.h Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">My Project
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.9.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">E:/_PhD/00_PST_CURRENT/rebin_calculation.h</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">//***********************************************************************************************************************************************************************************</span></div>
<div class="line"><a name="l00002"></a><span class="lineno"><a class="line" href="struct_x_y___data___point.html">    2</a></span>&#160;<span class="keyword">struct </span><a class="code" href="struct_x_y___data___point.html">XY_Data_Point</a>{</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;    <span class="keywordtype">double</span> x, y;</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;};</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">//-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="keywordtype">bool</span> rebin_source_sort_predicate(<span class="keyword">const</span> <a class="code" href="struct_x_y___data___point.html">XY_Data_Point</a> &amp;lhs, <span class="keyword">const</span> <a class="code" href="struct_x_y___data___point.html">XY_Data_Point</a> &amp;rhs) {<span class="keywordflow">return</span> lhs.x &lt; rhs.x;}</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">//***********************************************************************************************************************************************************************************</span></div>
<div class="line"><a name="l00008"></a><span class="lineno"><a class="line" href="class_rebin___calculation.html">    8</a></span>&#160;<span class="keyword">class </span><a class="code" href="class_rebin___calculation.html">Rebin_Calculation</a> : <span class="keyword">public</span> <a class="code" href="class_base___calculation.html">Base_Calculation</a>{</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;    <span class="keyword">public</span>:</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;        <span class="keywordtype">unsigned</span> method, specify_shape, bin_length, convolving_function;</div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;        <span class="keyword">const</span> gsl_interp_type *gsl_interpolation_type;</div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;        <span class="keywordtype">double</span> bin_size, new_x_min, new_x_max, convolving_function_width;</div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;        std::vector&lt;XY_Data_Point&gt; data;</div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;        std::string histogram_title, x_title, y_title;</div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;</div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;        <a class="code" href="class_rebin___calculation.html">Rebin_Calculation</a>(){}; <span class="comment">//C++ doesn&#39;t do virtual constructors, so we can&#39;t do much with this</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;        <a class="code" href="class_rebin___calculation.html">Rebin_Calculation</a>(<span class="keyword">const</span> std::string &amp;file_name){go(file_name);};</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;        <span class="keyword">virtual</span> ~<a class="code" href="class_rebin___calculation.html">Rebin_Calculation</a>(){};</div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;        <span class="keyword">virtual</span> <span class="keywordtype">void</span> initialise(<span class="keyword">const</span> std::string &amp;file_name);</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;        <span class="keyword">virtual</span> <span class="keywordtype">bool</span> run();</div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;        <span class="keywordtype">bool</span> simple_rebin();</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;        <span class="keywordtype">bool</span> interpolating_rebin();</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;        <span class="keywordtype">bool</span> convolving_rebin();</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;};</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment">//-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="keywordtype">void</span> Rebin_Calculation::initialise(<span class="keyword">const</span> std::string &amp;file_name){</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;    Base_Calculation::initialise(file_name);</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> NO_SECTION=0;</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> GENERAL=1;</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> DATA=2;</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;    <span class="keywordtype">unsigned</span> read_state=NO_SECTION;</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;    <span class="keywordtype">size_t</span> comma_position;</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;    std::string file_name_and_path=input_directory+file_name;</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    std::ifstream infile (file_name_and_path.c_str());</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;    std::string line, key, value;</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;    std::string x_string, y_string;</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;    <a class="code" href="struct_x_y___data___point.html">XY_Data_Point</a> temp_data_point;</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    <span class="keywordtype">unsigned</span> interpolation_type(0); <span class="comment">//default interpolation method is linear</span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    convolving_function=new_x_min=new_x_max=0;</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;    <span class="keywordflow">if</span> (infile.is_open()) {</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;        <span class="keywordflow">while</span>(getline(infile,line)) {</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;            <span class="keywordflow">if</span> (line.substr(0,2) != <span class="stringliteral">&quot;//&quot;</span>){ <span class="comment">//if this is not a comment line (we should ignore comment lines)</span></div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;                <span class="keywordflow">if</span> (line.substr(0,8) == <span class="stringliteral">&quot;--------&quot;</span>){ <span class="comment">//this is the start of a new section</span></div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;                    read_state=NO_SECTION; <span class="comment">//set to none first in case the section is not recognised by this parse routine</span></div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;                    <span class="keywordflow">if</span> (line.find(<span class="stringliteral">&quot;-GENERAL-&quot;</span>) != std::string::npos) read_state=GENERAL;</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;                    <span class="keywordflow">if</span> (line.find(<span class="stringliteral">&quot;-DATA-&quot;</span>) != std::string::npos) read_state=DATA;</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;                }</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;                <span class="keywordflow">if</span> (read_state==GENERAL){</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;                    read_key_value(line, key, value);</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;                    <span class="keywordflow">if</span> (key != <span class="stringliteral">&quot;&quot;</span>) {</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;                        <span class="keywordflow">if</span> (key == <span class="stringliteral">&quot;method&quot;</span>) method=atoi(value.c_str());</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;                        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (key == <span class="stringliteral">&quot;specify_shape&quot;</span>) specify_shape=atoi(value.c_str());</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;                        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (key == <span class="stringliteral">&quot;bin_length&quot;</span>) bin_length=atoi(value.c_str());</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;                        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (key == <span class="stringliteral">&quot;bin_size&quot;</span>) bin_size=atof(value.c_str());</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;                        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (key == <span class="stringliteral">&quot;new_x_min&quot;</span>) new_x_min=atof(value.c_str());</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;                        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (key == <span class="stringliteral">&quot;new_x_max&quot;</span>) new_x_max=atof(value.c_str());</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;                        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (key == <span class="stringliteral">&quot;histogram_title&quot;</span>) histogram_title=value;</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;                        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (key == <span class="stringliteral">&quot;x_title&quot;</span>) x_title=value;</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;                        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (key == <span class="stringliteral">&quot;y_title&quot;</span>) y_title=value;</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;                        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (key == <span class="stringliteral">&quot;interpolation_type&quot;</span>) interpolation_type=atoi(value.c_str());</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;                        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (key == <span class="stringliteral">&quot;convolving_function&quot;</span>) convolving_function=atoi(value.c_str());</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;                        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (key == <span class="stringliteral">&quot;convolving_function_width&quot;</span>) convolving_function_width=atof(value.c_str());</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;                    }</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;                }<span class="keywordflow">else</span> <span class="keywordflow">if</span> (read_state==DATA){</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;                    comma_position = line.find(<span class="stringliteral">&quot;,&quot;</span>);</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;                    <span class="keywordflow">if</span> (comma_position != std::string::npos){</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;                        x_string=line.substr(0, comma_position);</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;                        y_string=line.substr(comma_position + 1);</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;                        temp_data_point.x=atof(x_string.c_str());</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;                        temp_data_point.y=atof(y_string.c_str());</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;                        data.push_back(temp_data_point);</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;                    }</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;                }</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;            }</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;        }</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;        infile.close();</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    }</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    <span class="keywordflow">if</span> (method==1){</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;        <span class="keywordflow">if</span> (interpolation_type==0) gsl_interpolation_type=gsl_interp_linear;</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;        <span class="keywordflow">if</span> (interpolation_type==1) gsl_interpolation_type=gsl_interp_cspline;</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;        <span class="keywordflow">if</span> (interpolation_type==2) gsl_interpolation_type=gsl_interp_cspline_periodic;</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;        <span class="keywordflow">if</span> (interpolation_type==3) gsl_interpolation_type=gsl_interp_akima;</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;        <span class="keywordflow">if</span> (interpolation_type==4) gsl_interpolation_type=gsl_interp_akima_periodic;</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;    }</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;}</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;<span class="comment">//-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;<span class="keywordtype">bool</span> Rebin_Calculation::run(){</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    persistent_output &lt;&lt; <span class="stringliteral">&quot; - ReBin_Calculation:&quot;</span>;</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    <span class="keywordflow">if</span> (method==0) <span class="keywordflow">return</span> simple_rebin();</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    <span class="keywordflow">if</span> (method==1) <span class="keywordflow">return</span> interpolating_rebin();</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    <span class="keywordflow">if</span> (method==2) <span class="keywordflow">return</span> convolving_rebin();</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;}</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;<span class="comment">//-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;<span class="keywordtype">bool</span> Rebin_Calculation::simple_rebin(){</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    <span class="keywordtype">unsigned</span> i,j;</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    <span class="keywordtype">double</span> x_min, x_max, xi, l_bound_i, u_bound_i, l_bound_j, u_bound_j, half_w, overlap_weight;</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    <a class="code" href="class_histogram.html">Histogram</a> result;</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    persistent_output &lt;&lt; <span class="stringliteral">&quot; Simple&quot;</span>&lt;&lt; std::endl;</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    std::sort(data.begin(), data.end(), rebin_source_sort_predicate); <span class="comment">//SORT THE INPUT DATA BY x ASCENDING!</span></div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    x_min=x_max=data[0].x;</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    <span class="keywordflow">for</span> (i=0;i&lt;data.size();i++){ <span class="comment">//find the extents of the source data (which will be used as the extents of the output unless new, valid, extents have been specified)</span></div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;        <span class="keywordflow">if</span> (data[i].x&lt;x_min) x_min=data[i].x;</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;        <span class="keywordflow">if</span> (data[i].x&gt;x_max) x_max=data[i].x;</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    }</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    <span class="keywordflow">if</span> (new_x_min&lt;new_x_max &amp;&amp; x_min&lt;=new_x_min &amp;&amp; new_x_max&lt;=x_max){ <span class="comment">//if new extents have been specified, use them (provided they are within the extents of the source data)</span></div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;        x_min=new_x_min;</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;        x_max=new_x_max;</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;    }</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    <span class="keywordflow">if</span> (specify_shape==1) result.initialiseN(histogram_title, x_title, y_title, bin_length, x_max, x_min);</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    <span class="keywordflow">if</span> (specify_shape==2) result.initialiseS(histogram_title, x_title, y_title, bin_size, x_max, x_min); <span class="comment">//NOTE: this method requires the min and max to be an integer multiple of bin_size (I think it will crash otherwise)</span></div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    half_w=0.5*result.bin_size;</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    <span class="keywordflow">for</span> (i=0;i&lt;result.data.size();i++){</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;        xi=result.resolveIndex(i);</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;        l_bound_i=xi-half_w;</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;        u_bound_i=xi+half_w;</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;        l_bound_j=data[0].x;</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;        <span class="keywordflow">for</span> (j=0;j&lt;data.size();j++){</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;            <span class="keywordflow">if</span> (j) l_bound_j=data[j-1].x+(data[j].x-data[j-1].x);</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;            <span class="keywordflow">if</span> (j&lt;data.size()-1) u_bound_j=data[j].x+(data[j+1].x-data[j].x);</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;            <span class="keywordflow">else</span> u_bound_j=data[j].x;</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;            <span class="keywordflow">if</span> (u_bound_j &gt;= x_min &amp;&amp; l_bound_j &lt;= x_max) { <span class="comment">//only count if within the extents of the new histogram</span></div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;                <span class="keywordflow">if</span> (l_bound_j &gt;= l_bound_i &amp;&amp; u_bound_j &lt;= u_bound_i) { <span class="comment">// source bin is entirely within this destination bin</span></div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;                    result.increment_value(data[j].x, data[j].y); <span class="comment">//simply increment</span></div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;                }<span class="keywordflow">else</span> <span class="keywordflow">if</span> (l_bound_j &gt; l_bound_i &amp;&amp; l_bound_j &lt; u_bound_i){ <span class="comment">//only the lower bound of the source bin is within the bounds of this bin</span></div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;                    overlap_weight=(u_bound_i-l_bound_j)/(u_bound_j-l_bound_j); <span class="comment">//find the fraction of the source bin that overlaps this destination bin</span></div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;                    result.increment_value(xi, overlap_weight*data[j].y); <span class="comment">//increment this destination bin by the source bin value weighted by the overlap</span></div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;                }<span class="keywordflow">else</span> <span class="keywordflow">if</span> (u_bound_j &gt; l_bound_i &amp;&amp; u_bound_j &lt; u_bound_i){ <span class="comment">//only the upper bound of the source bin is within the bounds of this bin</span></div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;                    overlap_weight=(u_bound_j-l_bound_i)/(u_bound_j-l_bound_j); <span class="comment">//find the fraction of the source bin that overlaps this destination bin</span></div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;                    result.increment_value(xi, overlap_weight*data[j].y); <span class="comment">//increment this destination bin by the source bin value weighted by the overlap</span></div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;                }</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;            }</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;        }</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    }</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    result.write_histogram(out_file.fp);</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;}</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;<span class="comment">//-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;<span class="keywordtype">bool</span> Rebin_Calculation::interpolating_rebin(){</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    <span class="keywordtype">unsigned</span> i;</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    <span class="keywordtype">double</span> x_min, x_max, xi;</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    <span class="keywordtype">double</span> *x = <span class="keyword">new</span> <span class="keywordtype">double</span>[data.size()];</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    <span class="keywordtype">double</span> *y = <span class="keyword">new</span> <span class="keywordtype">double</span>[data.size()];</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    <a class="code" href="class_histogram.html">Histogram</a> result;</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    persistent_output &lt;&lt; <span class="stringliteral">&quot; Interpolating&quot;</span>&lt;&lt; std::endl;</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    std::sort(data.begin(), data.end(), rebin_source_sort_predicate); <span class="comment">//SORT THE INPUT DATA BY x ASCENDING!</span></div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    x_min=x_max=data[0].x;</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    <span class="keywordflow">for</span> (i=0;i&lt;data.size();i++){ <span class="comment">//copy the data into the format required for gsl and find the extents of the source data (which will be used as the extents of the output unless new, valid, extents have been specified)</span></div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;        <span class="keywordflow">if</span> (data[i].x&lt;x_min) x_min=data[i].x;</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;        <span class="keywordflow">if</span> (data[i].x&gt;x_max) x_max=data[i].x;</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;        x[i]=data[i].x;</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;        y[i]=data[i].y;</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    }</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    <span class="keywordflow">if</span> (new_x_min&lt;new_x_max &amp;&amp; x_min&lt;=new_x_min &amp;&amp; new_x_max&lt;=x_max){ <span class="comment">//if new extents have been specified, use them (provided they are within the extents of the source data)</span></div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;        x_min=new_x_min;</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;        x_max=new_x_max;</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    }</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    gsl_interp_accel *acc = gsl_interp_accel_alloc();</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    gsl_spline *spline = gsl_spline_alloc (gsl_interpolation_type, data.size());</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;    gsl_spline_init (spline, x, y, data.size());</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    <span class="keywordflow">if</span> (specify_shape==1) result.initialiseN(histogram_title, x_title, y_title, bin_length, x_max, x_min);</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    <span class="keywordflow">if</span> (specify_shape==2) result.initialiseS(histogram_title, x_title, y_title, bin_size, x_max, x_min);</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    <span class="keywordflow">for</span> (i=0;i&lt;result.data.size();i++){</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;        xi=result.resolveIndex(i);</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;        result.set_value(xi, gsl_spline_eval(spline, xi, acc));</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    }</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    result.write_histogram(out_file.fp);</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    <span class="keyword">delete</span> x;</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    <span class="keyword">delete</span> y;</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;}</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;<span class="comment">//-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;<span class="keywordtype">bool</span> Rebin_Calculation::convolving_rebin(){</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;    <span class="keywordtype">unsigned</span> i,j;</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;    <span class="keywordtype">double</span> x_min, x_max, xi, norm_factor(0), other_factor(0), dx, dy(0);</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    <a class="code" href="class_histogram.html">Histogram</a> result;</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;    persistent_output &lt;&lt; <span class="stringliteral">&quot; Convolving&quot;</span>&lt;&lt; std::endl;</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;    x_min=x_max=data[0].x;</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;    <span class="keywordflow">for</span> (i=0;i&lt;data.size();i++){ <span class="comment">//find the extents of the source data (which will be used as the extents of the output unless new, valid, extents have been specified)</span></div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;        <span class="keywordflow">if</span> (data[i].x&lt;x_min) x_min=data[i].x;</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;        <span class="keywordflow">if</span> (data[i].x&gt;x_max) x_max=data[i].x;</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;    }</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;    <span class="keywordflow">if</span> (new_x_min&lt;new_x_max &amp;&amp; x_min&lt;=new_x_min &amp;&amp; new_x_max&lt;=x_max){ <span class="comment">//if new extents have been specified, use them (provided they are within the extents of the source data)</span></div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;        x_min=new_x_min;</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;        x_max=new_x_max;</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    }</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    <span class="keywordflow">if</span> (specify_shape==1) result.initialiseN(histogram_title, x_title, y_title, bin_length, x_max, x_min);</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    <span class="keywordflow">if</span> (specify_shape==2) result.initialiseS(histogram_title, x_title, y_title, bin_size, x_max, x_min);</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    <span class="keywordflow">if</span> (convolving_function==0){ <span class="comment">//Gaussian</span></div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;        other_factor = -4*log(2)/pow(convolving_function_width,2);</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;        norm_factor = 2*sqrt(log(2))/(convolving_function_width*sqrt(PI));</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    }<span class="keywordflow">else</span> <span class="keywordflow">if</span>(convolving_function==1){ <span class="comment">//Lorentzian</span></div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;        other_factor = pow(convolving_function_width,2)/4.0;</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;        norm_factor = convolving_function_width/(2*PI);</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    }</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;    <span class="keywordflow">for</span> (i=0;i&lt;result.data.size();i++){</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;        xi=result.resolveIndex(i);</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;        <span class="keywordflow">for</span> (j=0;j&lt;data.size();j++){</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;            dx=xi-data[j].x;</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;            <span class="keywordflow">if</span> (convolving_function==0) dy=norm_factor*data[j].y*exp(other_factor*pow(dx,2)); <span class="comment">//Gaussian</span></div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span>(convolving_function==1) dy=norm_factor*data[j].y/(pow(dx,2)+other_factor); <span class="comment">//Lorentzian</span></div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;            result.increment_value(xi, dy);</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;        }</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    }</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    result.write_histogram(out_file.fp);</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;}</div>
<div class="ttc" id="class_base___calculation_html"><div class="ttname"><a href="class_base___calculation.html">Base_Calculation</a></div><div class="ttdef"><b>Definition:</b> base_calculation.h:3</div></div>
<div class="ttc" id="class_rebin___calculation_html"><div class="ttname"><a href="class_rebin___calculation.html">Rebin_Calculation</a></div><div class="ttdef"><b>Definition:</b> rebin_calculation.h:8</div></div>
<div class="ttc" id="class_histogram_html"><div class="ttname"><a href="class_histogram.html">Histogram</a></div><div class="ttdef"><b>Definition:</b> histogram.h:5</div></div>
<div class="ttc" id="struct_x_y___data___point_html"><div class="ttname"><a href="struct_x_y___data___point.html">XY_Data_Point</a></div><div class="ttdef"><b>Definition:</b> rebin_calculation.h:2</div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Mon Mar 30 2015 15:46:03 for My Project by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.9.1
</small></address>
</body>
</html>
